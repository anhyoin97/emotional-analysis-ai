<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>감정 분석 플랫폼</title>
    <style>
      body {
        margin: 0;
        font-family: "맑은 고딕", sans-serif;
        background-color: #f3f4f6;
        color: #333;
      }

      header {
        background-color: #0078d7;
        color: white;
        padding: 20px 40px;
        font-size: 1.5em;
        font-weight: bold;
        text-align: center;
      }

      main {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 40px;
        max-width: 900px;
        margin: 40px auto;
        padding: 0 20px;
      }

      section {
        background-color: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        flex: 1 1 400px;
        box-sizing: border-box;
      }

      textarea {
        width: 100%;
        height: 140px;
        box-sizing: border-box;
        border-radius: 8px;
        border: 1px solid #ccc;
        padding: 12px;
        font-size: 1em;
        resize: none;
      }

      button {
        margin-top: 16px;
        padding: 12px 24px;
        background-color: #0078d7;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1em;
      }

      button:hover {
        background-color: #005ea6;
      }

      .result-box {
        padding: 20px;
        border-left: 6px solid #0078d7;
        border-radius: 8px;
        background-color: #fefefe;
        transition: border-color 0.3s;
      }

      .result-item {
        margin-bottom: 12px;
        font-size: 1.05em;
      }

      .result-label {
        font-weight: bold;
      }

      .encouragement {
        margin-top: 20px;
        background-color: #f0f8ff;
        padding: 12px 16px;
        border-radius: 8px;
        border-left: 4px solid #00aaff;
        font-style: italic;
      }

      .score-guide {
        margin-top: 20px;
        font-size: 0.9em;
        color: #666;
        line-height: 1.4;
        background: #f7f7f7;
        padding: 10px 14px;
        border-radius: 8px;
      }

      footer {
        text-align: center;
        padding: 24px;
        font-size: 0.9em;
        color: #888;
        border-top: 1px solid #ddd;
        margin-top: 40px;
      }
    </style>
  </head>
  <body>
    <header>📝 감정 분석 플랫폼</header>

    <main>
      <section>
        <h2>오늘의 감정일기 작성</h2>
        <form id="diary-form">
          <textarea
            name="diary"
            placeholder="오늘 하루를 솔직하게 적어보세요..."
          ></textarea>
          <button type="submit">분석하기</button>
        </form>
      </section>

      <section>
        <h2>분석 결과</h2>
        <div id="result">
          <p style="color: #888">
            일기를 작성하면 분석 결과가 여기에 표시됩니다.
          </p>
        </div>
      </section>
    </main>

    <footer>© HYOIN AN | 2025 감정분석 플랫폼</footer>

    <script>
      const emotionIcons = {
        우울: "😢",
        불안: "😟",
        분노: "😠",
        기쁨: "😄",
        슬픔: "😭",
        안정: "😊",
        피로: "😩",
        무기력: "😞",
        절망: "😔",
        희망: "🌈",
      };

      const resultDiv = document.getElementById("result");
      const form = document.getElementById("diary-form");
      const button = form.querySelector("button");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // 로딩 표시
        resultDiv.innerHTML = `<p style="color: #0078D7;">🧠 감정 분석 중입니다...</p>`;
        button.disabled = true;
        button.textContent = "분석 중...";

        const formData = new FormData(e.target);
        const res = await fetch("/analyze", {
          method: "POST",
          body: formData,
        });

        button.disabled = false;
        button.textContent = "분석하기";

        const data = await res.json();

        if (data.error) {
          resultDiv.innerHTML = `<p style="color:red;">⚠️ 분석 실패: ${
            data.raw || data.detail
          }</p>`;
          return;
        }

        const color =
          data.score >= 81
            ? "#d9534f"
            : data.score >= 61
            ? "#f0ad4e"
            : data.score >= 31
            ? "#f9e79f"
            : "#5cb85c";
        const icon = emotionIcons[data.emotion] || "🧠";

        resultDiv.innerHTML = `
      <div class="result-box" style="border-color: ${color};">
        <div class="result-item"><span class="result-label">감정:</span> ${icon} ${
          data.emotion
        }</div>
        <div class="result-item"><span class="result-label">점수:</span> ${
          data.score
        }점</div>
        <div class="result-item"><span class="result-label">이유:</span> ${
          data.reason
        }</div>
        <div class="result-item"><span class="result-label">응원의 한마디:</span> ${
          data.message
        }</div>
        <div class="encouragement">💬 오늘의 위로: “${
          data.comfort || "오늘도 잘 버텼어요. 수고했어요 :)"
        }”</div>
        <div class="score-guide">
          <strong>점수 해석 안내:</strong><br>
          ✅ 0~30: 감정 안정 상태<br>
          ⚠️ 31~60: 가벼운 감정 변화<br>
          ❗ 61~80: 부정 감정 강함<br>
          🔥 81~100: 감정적으로 매우 힘든 상태
        </div>
      </div>
    `;
      });
    </script>
  </body>
</html>
